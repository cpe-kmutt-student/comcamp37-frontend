"use client"

import { useState, useEffect } from "react"
import { motion, AnimatePresence } from "motion/react"
import {useRouter} from "next/navigation";

import { initializeClarity} from "@/app/metrics/MicrosoftClarity";

export function CookieModal() {
    const router = useRouter()
    // เริ่มต้นเป็น false ก่อนเพื่อป้องกัน Hydration Error
    const [isVisible, setIsVisible] = useState(false)

    useEffect(() => {
        const consent = localStorage.getItem("comcamp37-cookie-consent")
        if (!consent) {
            const timer = setTimeout(() => setIsVisible(true), 1000)
            return () => clearTimeout(timer)
        }
    }, [])

    const handleAccept = () => {
        localStorage.setItem("comcamp37-cookie-consent", "true")
        initializeClarity();
        setIsVisible(false)
    }

    return (
        <AnimatePresence>
            {isVisible && (
                <motion.div
                    initial={{ y: 100, opacity: 0 }}
                    animate={{ y: 0, opacity: 1 }}
                    exit={{ y: 100, opacity: 0 }}
                    transition={{ type: "spring", stiffness: 300, damping: 30 }}
                    className="fixed md:right-5 bottom-0 md:bottom-5 w-[100%] md:w-auto md:max-w-[520px] md:mr-15 rounded-4xl border-3 border-theme-secondary bg-theme-primary/80 z-50 backdrop-blur-xl shadow-2xl"
                >
                    <div className="bg-theme-primary-darken/80 py-4 px-5 rounded-t-[calc(2rem-3px)] text-xl font-bold text-white">
                        We use cookies!
                    </div>

                    <div className="px-5 py-6 text-white/90">
                        เว็บไซต์ ComCamp 37 มีการใช้ <b>คุกกี้ (Cookie)</b> พื้นฐานที่จำเป็นซึ่งช่วยให้
                        สามารถเข้าใช้เว็บไซต์ได้โดยการเปิดใช้ฟังก์ชันพื้นฐานต่างๆ และการเข้าสู่
                        ส่วนที่ปลอดภัยของเว็บไซต์ หากไม่มีคุกกี้เหล่านี้ จะไม่สามารถทำงานได้ อย่างถูกต้อง
                    </div>

                    {/* Buttons */}
                    <div className="flex flex-col md:flex-row gap-3 p-4 pt-0">
                        <motion.button
                            whileHover={{ scale: 1.02 }}
                            whileTap={{ scale: 0.95 }}
                            className="flex-1 rounded-2xl p-4 bg-white/10 hover:bg-white/20 transition-colors cursor-pointer text-white font-medium"
                            onClick={() => router.push('/privacy')}
                        >
                            นโยบายความเป็นส่วนตัว
                        </motion.button>

                        <motion.button
                            whileHover={{ scale: 1.02 }}
                            whileTap={{ scale: 0.95 }}
                            onClick={handleAccept}
                            className="flex-1 rounded-2xl p-4 bg-theme-primary-darken hover:bg-theme-secondary transition-colors cursor-pointer text-white font-bold shadow-lg relative"
                        >
                            ยอมรับ
                            <div className="md:hidden block absolute -top-3 -right-3 pointer-events-none select-none z-10 w-10 h-auto">
                                <svg className="origin-bottom-left drop-shadow-xl" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <mask id="path-1-inside-1_698_1253" fill="white">
                                        <path d="M58.4941 0C57.9178 1.48255 57.6016 3.09495 57.6016 4.78125C57.6017 10.1408 60.7961 14.7538 65.3848 16.8213C63.5199 19.0976 62.4005 22.0084 62.4004 25.1807C62.4004 32.4708 68.3104 38.3809 75.6006 38.3809L75.6016 38.3799V38.3809C75.6016 45.671 81.5116 51.5811 88.8018 51.5811C92.9103 51.5809 96.5801 49.7031 99.001 46.7598C101.422 49.7032 105.092 51.581 109.2 51.5811C112.935 51.581 116.305 50.0289 118.706 47.5361C119.553 51.5512 120 55.7143 120 59.9814C120 93.1184 93.137 119.981 60 119.981C26.863 119.981 0.000182305 93.1184 0 59.9814C0 27.3478 26.0529 0.799144 58.4941 0Z"/>
                                    </mask>
                                    <path d="M58.4941 0C57.9178 1.48255 57.6016 3.09495 57.6016 4.78125C57.6017 10.1408 60.7961 14.7538 65.3848 16.8213C63.5199 19.0976 62.4005 22.0084 62.4004 25.1807C62.4004 32.4708 68.3104 38.3809 75.6006 38.3809L75.6016 38.3799V38.3809C75.6016 45.671 81.5116 51.5811 88.8018 51.5811C92.9103 51.5809 96.5801 49.7031 99.001 46.7598C101.422 49.7032 105.092 51.581 109.2 51.5811C112.935 51.581 116.305 50.0289 118.706 47.5361C119.553 51.5512 120 55.7143 120 59.9814C120 93.1184 93.137 119.981 60 119.981C26.863 119.981 0.000182305 93.1184 0 59.9814C0 27.3478 26.0529 0.799144 58.4941 0Z" fill="#4C3B33"/>
                                    <path d="M58.4941 0L61.2903 1.08708L62.922 -3.10998L58.4203 -2.99909L58.4941 0ZM57.6016 4.78125L54.6016 4.78122V4.78133L57.6016 4.78125ZM65.3848 16.8213L67.7054 18.7225L70.1864 15.6943L66.6172 14.0861L65.3848 16.8213ZM62.4004 25.1807L59.4004 25.1806V25.1807H62.4004ZM75.6006 38.3809V41.3809H76.8432L77.7219 40.5022L75.6006 38.3809ZM75.6016 38.3799H78.6016V31.1372L73.4802 36.2586L75.6016 38.3799ZM75.6016 38.3809H72.6016V38.3809L75.6016 38.3809ZM88.8018 51.5811V54.5811H88.8018L88.8018 51.5811ZM99.001 46.7598L101.318 44.8541L99.001 42.037L96.684 44.8541L99.001 46.7598ZM109.2 51.5811L109.2 54.5811H109.2L109.2 51.5811ZM118.706 47.5361L121.641 46.9169L120.473 41.377L116.545 45.455L118.706 47.5361ZM120 59.9814L123 59.9815V59.9814H120ZM60 119.981V122.981V122.981V119.981ZM0 59.9814H-3V59.9815L0 59.9814ZM58.4941 0L55.698 -1.08708C54.989 0.736545 54.6016 2.7172 54.6016 4.78122L57.6016 4.78125L60.6016 4.78128C60.6016 3.47269 60.8465 2.22855 61.2903 1.08708L58.4941 0ZM57.6016 4.78125L54.6016 4.78133C54.6017 11.3638 58.5275 17.0221 64.1524 19.5565L65.3848 16.8213L66.6172 14.0861C63.0647 12.4855 60.6017 8.91789 60.6016 4.78117L57.6016 4.78125ZM65.3848 16.8213L63.0641 14.9201C60.7762 17.7127 59.4005 21.2899 59.4004 25.1806L62.4004 25.1807L65.4004 25.1807C65.4005 22.7269 66.2635 20.4825 67.7054 18.7225L65.3848 16.8213ZM62.4004 25.1807H59.4004C59.4004 34.1277 66.6536 41.3809 75.6006 41.3809V38.3809V35.3809C69.9673 35.3809 65.4004 30.814 65.4004 25.1807H62.4004ZM75.6006 38.3809L77.7219 40.5022L77.7229 40.5012L75.6016 38.3799L73.4802 36.2586L73.4793 36.2595L75.6006 38.3809ZM75.6016 38.3799H72.6016V38.3809H75.6016H78.6016V38.3799H75.6016ZM75.6016 38.3809L72.6016 38.3809C72.6016 47.3278 79.8548 54.5811 88.8018 54.5811V51.5811V48.5811C83.1685 48.5811 78.6016 44.0141 78.6016 38.3808L75.6016 38.3809ZM88.8018 51.5811L88.8018 54.5811C93.8456 54.5809 98.352 52.2716 101.318 48.6654L99.001 46.7598L96.684 44.8541C94.8083 47.1347 91.9749 48.581 88.8017 48.5811L88.8018 51.5811ZM99.001 46.7598L96.684 48.6654C99.65 52.2716 104.156 54.581 109.2 54.5811L109.2 51.5811L109.2 48.5811C106.027 48.581 103.194 47.1347 101.318 44.8541L99.001 46.7598ZM109.2 51.5811L109.2 54.5811C113.784 54.581 117.925 52.6721 120.867 49.6172L118.706 47.5361L116.545 45.455C114.686 47.3858 112.085 48.581 109.2 48.5811L109.2 51.5811ZM118.706 47.5361L115.771 48.1553C116.575 51.9688 117 55.9244 117 59.9814H120H123C123 55.5042 122.531 51.1337 121.641 46.9169L118.706 47.5361ZM120 59.9814L117 59.9814C117 91.4615 91.4801 116.981 60 116.981V119.981V122.981C94.7938 122.981 123 94.7752 123 59.9815L120 59.9814ZM60 119.981V116.981C28.5199 116.981 3.00017 91.4615 3 59.9814L0 59.9814L-3 59.9815C-2.99981 94.7752 25.2062 122.981 60 122.981V119.981ZM0 59.9814H3C3 28.9799 27.7503 3.75824 58.568 2.99909L58.4941 0L58.4203 -2.99909C24.3555 -2.15995 -3 25.7157 -3 59.9814H0Z" fill="#EB8B51" mask="url(#path-1-inside-1_698_1253)"/>
                                    <circle cx="48.7992" cy="26.3991" r="5.6" fill="#624533"/>
                                    <circle cx="59.9984" cy="59.9992" r="5.6" fill="#624533"/>
                                    <circle cx="21.5996" cy="54.3992" r="4" fill="#624533"/>
                                    <circle cx="69.6016" cy="81.5991" r="4" fill="#624533"/>
                                    <circle cx="74" cy="108" r="4" fill="#624533"/>
                                    <circle cx="95.1996" cy="71.1989" r="5.6" fill="#624533"/>
                                    <circle cx="37.6" cy="87.1991" r="5.6" fill="#624533"/>
                                </svg>
                            </div>
                        </motion.button>
                    </div>

                    {/* SVG Decor - Keeping existing svg but ensuring pointer-events-none so it doesn't block clicks */}
                    <div className="hidden md:block absolute -top-15 -right-15 pointer-events-none select-none z-10">
                        <svg className="origin-bottom-left drop-shadow-xl" width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <mask id="path-1-inside-1_698_1253" fill="white">
                                <path d="M58.4941 0C57.9178 1.48255 57.6016 3.09495 57.6016 4.78125C57.6017 10.1408 60.7961 14.7538 65.3848 16.8213C63.5199 19.0976 62.4005 22.0084 62.4004 25.1807C62.4004 32.4708 68.3104 38.3809 75.6006 38.3809L75.6016 38.3799V38.3809C75.6016 45.671 81.5116 51.5811 88.8018 51.5811C92.9103 51.5809 96.5801 49.7031 99.001 46.7598C101.422 49.7032 105.092 51.581 109.2 51.5811C112.935 51.581 116.305 50.0289 118.706 47.5361C119.553 51.5512 120 55.7143 120 59.9814C120 93.1184 93.137 119.981 60 119.981C26.863 119.981 0.000182305 93.1184 0 59.9814C0 27.3478 26.0529 0.799144 58.4941 0Z"/>
                            </mask>
                            <path d="M58.4941 0C57.9178 1.48255 57.6016 3.09495 57.6016 4.78125C57.6017 10.1408 60.7961 14.7538 65.3848 16.8213C63.5199 19.0976 62.4005 22.0084 62.4004 25.1807C62.4004 32.4708 68.3104 38.3809 75.6006 38.3809L75.6016 38.3799V38.3809C75.6016 45.671 81.5116 51.5811 88.8018 51.5811C92.9103 51.5809 96.5801 49.7031 99.001 46.7598C101.422 49.7032 105.092 51.581 109.2 51.5811C112.935 51.581 116.305 50.0289 118.706 47.5361C119.553 51.5512 120 55.7143 120 59.9814C120 93.1184 93.137 119.981 60 119.981C26.863 119.981 0.000182305 93.1184 0 59.9814C0 27.3478 26.0529 0.799144 58.4941 0Z" fill="#4C3B33"/>
                            <path d="M58.4941 0L61.2903 1.08708L62.922 -3.10998L58.4203 -2.99909L58.4941 0ZM57.6016 4.78125L54.6016 4.78122V4.78133L57.6016 4.78125ZM65.3848 16.8213L67.7054 18.7225L70.1864 15.6943L66.6172 14.0861L65.3848 16.8213ZM62.4004 25.1807L59.4004 25.1806V25.1807H62.4004ZM75.6006 38.3809V41.3809H76.8432L77.7219 40.5022L75.6006 38.3809ZM75.6016 38.3799H78.6016V31.1372L73.4802 36.2586L75.6016 38.3799ZM75.6016 38.3809H72.6016V38.3809L75.6016 38.3809ZM88.8018 51.5811V54.5811H88.8018L88.8018 51.5811ZM99.001 46.7598L101.318 44.8541L99.001 42.037L96.684 44.8541L99.001 46.7598ZM109.2 51.5811L109.2 54.5811H109.2L109.2 51.5811ZM118.706 47.5361L121.641 46.9169L120.473 41.377L116.545 45.455L118.706 47.5361ZM120 59.9814L123 59.9815V59.9814H120ZM60 119.981V122.981V122.981V119.981ZM0 59.9814H-3V59.9815L0 59.9814ZM58.4941 0L55.698 -1.08708C54.989 0.736545 54.6016 2.7172 54.6016 4.78122L57.6016 4.78125L60.6016 4.78128C60.6016 3.47269 60.8465 2.22855 61.2903 1.08708L58.4941 0ZM57.6016 4.78125L54.6016 4.78133C54.6017 11.3638 58.5275 17.0221 64.1524 19.5565L65.3848 16.8213L66.6172 14.0861C63.0647 12.4855 60.6017 8.91789 60.6016 4.78117L57.6016 4.78125ZM65.3848 16.8213L63.0641 14.9201C60.7762 17.7127 59.4005 21.2899 59.4004 25.1806L62.4004 25.1807L65.4004 25.1807C65.4005 22.7269 66.2635 20.4825 67.7054 18.7225L65.3848 16.8213ZM62.4004 25.1807H59.4004C59.4004 34.1277 66.6536 41.3809 75.6006 41.3809V38.3809V35.3809C69.9673 35.3809 65.4004 30.814 65.4004 25.1807H62.4004ZM75.6006 38.3809L77.7219 40.5022L77.7229 40.5012L75.6016 38.3799L73.4802 36.2586L73.4793 36.2595L75.6006 38.3809ZM75.6016 38.3799H72.6016V38.3809H75.6016H78.6016V38.3799H75.6016ZM75.6016 38.3809L72.6016 38.3809C72.6016 47.3278 79.8548 54.5811 88.8018 54.5811V51.5811V48.5811C83.1685 48.5811 78.6016 44.0141 78.6016 38.3808L75.6016 38.3809ZM88.8018 51.5811L88.8018 54.5811C93.8456 54.5809 98.352 52.2716 101.318 48.6654L99.001 46.7598L96.684 44.8541C94.8083 47.1347 91.9749 48.581 88.8017 48.5811L88.8018 51.5811ZM99.001 46.7598L96.684 48.6654C99.65 52.2716 104.156 54.581 109.2 54.5811L109.2 51.5811L109.2 48.5811C106.027 48.581 103.194 47.1347 101.318 44.8541L99.001 46.7598ZM109.2 51.5811L109.2 54.5811C113.784 54.581 117.925 52.6721 120.867 49.6172L118.706 47.5361L116.545 45.455C114.686 47.3858 112.085 48.581 109.2 48.5811L109.2 51.5811ZM118.706 47.5361L115.771 48.1553C116.575 51.9688 117 55.9244 117 59.9814H120H123C123 55.5042 122.531 51.1337 121.641 46.9169L118.706 47.5361ZM120 59.9814L117 59.9814C117 91.4615 91.4801 116.981 60 116.981V119.981V122.981C94.7938 122.981 123 94.7752 123 59.9815L120 59.9814ZM60 119.981V116.981C28.5199 116.981 3.00017 91.4615 3 59.9814L0 59.9814L-3 59.9815C-2.99981 94.7752 25.2062 122.981 60 122.981V119.981ZM0 59.9814H3C3 28.9799 27.7503 3.75824 58.568 2.99909L58.4941 0L58.4203 -2.99909C24.3555 -2.15995 -3 25.7157 -3 59.9814H0Z" fill="#EB8B51" mask="url(#path-1-inside-1_698_1253)"/>
                            <circle cx="48.7992" cy="26.3991" r="5.6" fill="#624533"/>
                            <circle cx="59.9984" cy="59.9992" r="5.6" fill="#624533"/>
                            <circle cx="21.5996" cy="54.3992" r="4" fill="#624533"/>
                            <circle cx="69.6016" cy="81.5991" r="4" fill="#624533"/>
                            <circle cx="74" cy="108" r="4" fill="#624533"/>
                            <circle cx="95.1996" cy="71.1989" r="5.6" fill="#624533"/>
                            <circle cx="37.6" cy="87.1991" r="5.6" fill="#624533"/>
                        </svg>
                    </div>
                </motion.div>
            )}
        </AnimatePresence>
    )
}